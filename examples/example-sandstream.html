<!doctype html>
<html dir="ltr" lang="en-US">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link href="style.css" rel="stylesheet">
    <script src="../src/bundle.js" data-cfasync="false"></script>
  </head>
<body>
  <div id="btn-revokeChoice" style="color: white; padding: 32px">Change my consent</div>
  
  <script>
    const CC = window.CookieConsent;
      const cc = new CC({
        // just some default styling
        "palette": {
          "popup": {
            "background": "black",
            "text": "white"
          },
          "button": {
            "background": "#f5d948"
          }
        },
        type: 'opt-in',
        consentSettingsElemId: 'btn-revokeChoice',
        layout: 'sanddev',
        showCategories: ['ESSENTIAL', 'ANALYTICS'],
        content: {
          hrefPrivacyPolicy: '/privacy-policy',
          hrefCookiePolicy: '/cookie-policy'
        }
      });

      cc.on('initialized', function () {
        const statusesMap = cc.getStatusesMap();

        if (statusesMap['ANALYTICS'] === 'ALLOW') {
          initializeGTM();
        }

        console.info('initialized', statusesMap);
      });

      cc.on('popupClosed', function () {
        const statusesMap = cc.getStatusesMap();

        if (statusesMap['ANALYTICS'] === 'ALLOW') {
          initializeGTM();
        }

        if (statusesMap['ANALYTICS'] === 'DENY' && window.gtmInitialized) {
          // reload page to get rid of GTM
          location.reload();
        }
      });

      function initializeGTM() {
        // if (!window.gtmInitialized) {
        //   window.dataLayer.push({
        //     'gtm.start': new Date().getTime(),
        //     event: 'gtm.js'
        //   });
        //   var f = document.getElementsByTagName('script')[0];
        //   var j = document.createElement('script');
        //   j.async = true;
        //   j.src =
        //     'https://www.googletagmanager.com/gtm.js?id={{ site.GTM_CONTAINER_ID }}';
        //   f.parentNode.insertBefore(j, f);
        window.gtmInitialized = true;
        // }

        console.log('gtm initialized');
      }
    </script>
  </body>
</html>
